---
import { getEntryBySlug } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export const slugMap = {
  project1: 'project1',
  project2: 'project2',
  project3: 'project3',
  'match-engine': 'project2',
  'cloud-security-pipeline': 'project1',
};

export async function getStaticPaths() {
  return Object.keys(slugMap).map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const projectSlug = slugMap[slug];
const project = projectSlug ? await getEntryBySlug('projects', projectSlug) : null;

if (!project) {
  throw new Response('Not found', { status: 404 });
}

const { Content } = await project.render();
---

<Layout>
  <a href="/projects" class="btn-secondary mb-4 inline-flex items-center gap-2">&larr; Back to Projects</a>
  <article class="mx-auto max-w-3xl space-y-6">
    <img
      src={project.data.thumbnail}
      alt={project.data.title}
      class="w-full rounded-lg shadow-sm"
      loading="lazy"
    />

    <header>
      <h1 class="text-3xl font-bold">{project.data.title}</h1>
      <p class="mt-2 text-gray-600 dark:text-gray-300">{project.data.description}</p>
      <div class="mt-3 flex flex-wrap gap-2">
        {project.data.tags?.map((tag) => (
          <span class="pill">{tag}</span>
        ))}
      </div>
    </header>

    <div class="prose max-w-none">
      <Content />
    </div>

    {(project.data.demoUrl || project.data.githubUrl) && (
      <div class="flex flex-wrap gap-4">
        {project.data.demoUrl && (
          <a href={project.data.demoUrl} class="btn-secondary" target="_blank" rel="noopener">
            View Demo
          </a>
        )}
        {project.data.githubUrl && (
          <a href={project.data.githubUrl} class="btn-secondary" target="_blank" rel="noopener">
            View Code
          </a>
        )}
      </div>
    )}
  </article>
</Layout>
